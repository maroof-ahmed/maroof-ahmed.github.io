"use strict";angular.module("USD$").controller("homeController",["$scope","$http","$filter","$sce",function(e,t,r,a){app.showProcessing(),$(".active-pill").removeClass("active-pill"),$(".home-pill").addClass("active-pill");var s="http://api.dronestre.am/data";s=a.trustAsResourceUrl(s),t({method:"jsonp",url:s}).then(function(t){if(console.log("data",t),200==t.status){app.hideProcessing(),e.droneData=t.data.strike.reverse();var a=e.droneData;$("body").animate({scrollTop:$("body").offset().top},1),e.allCountries=[],e.allYears=[],a.forEach(function(t){t.targetText=t.target,t.targetText&&t.targetText.indexOf(";")>=0?(t.targetText=t.targetText.split(";"),t.targetText=t.targetText[0]+" and Others"):a.targetText=a.target,""!=t.names[0]?t.namesArray=t.names[0].split(","):t.namesArray=[],e.allCountries.indexOf(t.country)==-1&&e.allCountries.push(t.country),e.allYears.indexOf(r("date")(t.date,"yyyy"))==-1&&e.allYears.push(r("date")(t.date,"yyyy")),"Maulvi Liaqat"==t.target&&console.log("droneData.targetText ",t)}),e.initialDroneData=e.droneData,console.log("$scope.allCountries",e.allCountries),e.filterByDeaths=function(e){return parseInt(e.deaths_max)?parseInt(e.deaths_max):"Unknown"==e.deaths?-1:parseInt(e.deaths)},e.filterDeathsInjuries=99999,e.setFilterVal=function(t){if(""==this.filterType)return this.hasFilter=!1,a=e.droneData,""==e.sorter,e.filterDeathsInjuries=0,this.setPage(1),!0;if(this.hasFilter=!0,"country"==this.filterType&&this.filterCountry)if(""!=this.filterCountry){a=r("filter")(e.droneData,this.filterCountry);var s=this;a=r("filter")(e.droneData,function(e,t,r){var a=e.country;return a==s.filterCountry})}else a=e.droneData;if("year"==this.filterType&&this.filterYear)if(""!=this.filterYear){var s=this;a=r("filter")(e.droneData,function(e,t,a){var n=e.date,i=r("date")(n,"yyyy");return parseInt(i)==parseInt(s.filterYear)})}else a=e.droneData;if("deaths"==this.filterType){var s=this;a=r("filter")(e.droneData,function(e,t,r){var a=e.deaths.indexOf("-")!=-1?e.deaths_max:e.deaths;return parseInt(a)>=parseInt(s.filterDeathsInjuries)})}if("injuries"==this.filterType){var s=this;a=r("filter")(e.droneData,function(e,t,r){var a=""!=e.injuries?e.injuries:0;return e.injuries.indexOf("-")!=-1?a=parseInt(e.injuries.split("-").pop()):"Dozens"==a?a=24:"Some"==a?a=7:"Several"==a&&(a=30),parseInt(a)>=parseInt(s.filterDeathsInjuries)})}this.setPage(1)},e.sortByDeaths=function(e){return parseInt(e.deaths_max)?parseInt(e.deaths_max):"Unknown"==e.deaths?-1:parseInt(e.deaths)},e.sortByInjuries=function(e){return e.injuries?e.injuries.indexOf("-")!=-1?parseInt(e.injuries.split("-").pop()):"Dozens"==e.injuries?24:"Some"==e.injuries?7:"Several"==e.injuries?30:parseInt(e.injuries):0},e.setSort=function(){""==e.sorter&&(a=e.initialDroneData),"latest"==e.sorter&&(a=r("orderBy")(a,"date",!0)),"oldest"==e.sorter&&(a=r("orderBy")(a,"date")),"country"==e.sorter&&(a=r("orderBy")(a,"country")),"max_deaths"==e.sorter&&(a=r("orderBy")(a,e.sortByDeaths,!0)),"min_deaths"==e.sorter&&(a=r("orderBy")(a,e.sortByDeaths)),"max_injuries"==e.sorter&&(a=r("orderBy")(a,e.sortByInjuries,!0)),"min_injuries"==e.sorter&&(a=r("orderBy")(a,e.sortByInjuries)),e.setPage(1)},e.pagedDroneData=[],e.totalItems=a.length,e.currentPage=1,e.maxSize=5,e.itemsPerPage=20;var s=(e.currentPage-1)*e.itemsPerPage,n=s+e.itemsPerPage;e.sorter="latest","latest"==e.sorter&&(e.pagedDroneData=a.slice(s,n)),e.setPage=function(t){e.currentPage=t,e.pageChanged(),console.log("filtered",a)},e.pageChanged=function(){e.totalItems=a.length,app.showProcessing(),console.log("Page changed to: "+e.currentPage);var t=(e.currentPage-1)*e.itemsPerPage,r=t+e.itemsPerPage;e.pagedDroneData=a.slice(t,r),$("body").animate({scrollTop:$("body").offset().top},1400),app.hideProcessing()},$(document).ready(function(){$(".data-Item").on("mouseover",function(e){$(".image",this).addClass("animate-top")}),$(".data-Item").on("mouseout",function(){$(".image",this).removeClass("animate-top")})})}},function(e){app.hideProcessing(),alert("Error in Requesting Data"),console.log("Error in Requesting Data",e)}),e.page="Home"}]);